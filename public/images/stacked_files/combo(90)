YUI.add("hermes-template-group-recs-rail-item",(function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,l,a){var r,i,o=null!=n?n:t.nullContext||{},u=t.hooks.helperMissing,s="function",c=t.escapeExpression,d=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t\t<a\n\t\t\t\t\tclass="avatar group tiny"\n\t\t\t\t\thref="'+c(typeof(i=null!=(i=d(e,"url")||(null!=n?d(n,"url"):n))?i:u)===s?i.call(o,{name:"url",hash:{},data:a,loc:{start:{line:7,column:11},end:{line:7,column:18}}}):i)+'"\n\t\t\t\t\tstyle="background-image: url('+c(t.lambda(null!=(r=null!=n?d(n,"buddyicon"):n)?d(r,"default"):r,n))+');"\n\t\t\t\t\tdata-group-nsid="'+c(typeof(i=null!=(i=d(e,"id")||(null!=n?d(n,"id"):n))?i:u)===s?i.call(o,{name:"id",hash:{},data:a,loc:{start:{line:9,column:22},end:{line:9,column:28}}}):i)+'"></a>\n'},compiler:[8,">= 4.3.0"],main:function(t,n,e,l,a){var r,i,o=null!=n?n:t.nullContext||{},u=t.hooks.helperMissing,s="function",c=t.escapeExpression,d=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="group-recs-rail-item">\n\t<header>\n\t\t<div class="left-container">\n'+(null!=(r=d(e,"if").call(o,null!=n?d(n,"buddyicon"):n,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:4,column:3},end:{line:10,column:10}}}))?r:"")+'\n\t\t\t<a class="title" href="'+c(typeof(i=null!=(i=d(e,"url")||(null!=n?d(n,"url"):n))?i:u)===s?i.call(o,{name:"url",hash:{},data:a,loc:{start:{line:12,column:26},end:{line:12,column:33}}}):i)+'">'+c(typeof(i=null!=(i=d(e,"title")||(null!=n?d(n,"title"):n))?i:u)===s?i.call(o,{name:"title",hash:{},data:a,loc:{start:{line:12,column:35},end:{line:12,column:44}}}):i)+'</a>\n\t\t</div>\n\t\t<div class="right-container">\n\t\t\t<div class="join-button-container">\n\t\t\t</div>\n\t\t</div>\n\t</header>\n\t<div class="list-container">\n\t\t'+c((d(e,"renderTrustedMarkup")||n&&d(n,"renderTrustedMarkup")||u).call(o,null!=n?d(n,"content"):n,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:20,column:2},end:{line:20,column:33}}}))+"\n\t</div>\n</div>\n"},useData:!0}),l={};t.Array.each([],(function(n){var e=t.Template.get("hermes/"+n);e&&(l[n]=e)})),t.Template.register("hermes/group-recs-rail-item",(function(n,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,e(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("group-recs-rail-item-view",(function(t,e){require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create("group-recs-rail-item-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.params.groupId=this.params.id,this.justifiedLayout=require("justified-layout"),this.photoSizeHelper=new t.PhotoSizeHelper(this.appContext),this},loadState:function(){return t.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-recs-rail-item",this.params)},activate:function(){var t=this.get("container");return this.listContainerNode=t.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.joinButtonContainer=t.one(".join-button-container"),this.buildLayout(),this.buildJoinButton()},buildLayout:function(){var e,i=this,o=t.Node.create('<div class="group-photo-layout"></div>'),n=this.params.photos,r=n.map((function(t){return Math.min(t.aspectRatio,2)})),a=0,s=0,h=0;(e=i.justifiedLayout(r,{containerWidth:this.listContainerNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:4,vertical:4},targetRowHeight:50,targetRowHeightTolerance:.2})).boxes.some((function(t,i){s<t.top&&(s=t.top,++a>=1&&(h=h||i,e.containerHeight=e.containerHeight-t.height-4))})),h||(h=e.boxes.length),e.boxes=e.boxes.slice(0,h),o.setStyle("position","relative"),o.setStyle("height",e.containerHeight),e.boxes.forEach((function(e,r){var a=n[r],s=t.Node.create('<a class="group-photo-item" href="'+a.link+'" data-item-id="'+a.id+'"></a>'),h=i.photoSizeHelper.getSizeToFit(a.sizes,{width:e.width,height:e.height},{includeSquare:!1}),l=h?h.displayUrl:a.url;s.setStyle("background-image","url("+l+")"),s.setStyle("top",e.top),s.setStyle("left",e.left),s.setStyle("width",e.width),s.setStyle("height",e.height),o.appendChild(s)})),this.listContainerNode.appendChild(o)},buildJoinButton:function(){var t=this;return this.appContext.getView("join-group-view",{groupId:this.params.id,useSearchModel:!1,theme:"flex-hollow",shortLabels:!0}).then((function(t){return t.initialize()})).then((function(e){return t.joinButtonContainer.appendChild(e.get("container")),e.activate()}))}})}),"@VERSION@",{requires:["flickr-view","join-group-view","hermes-template-group-recs-rail-item"],optionalRequires:["hermes-core"],langBundles:["common"]});YUI.add("hermes-template-group-recs-rail-card",(function(t,i){var s=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,i,s,e,n){var a=t.lookupProperty||function(t,i){if(Object.prototype.hasOwnProperty.call(t,i))return t[i]};return'<div class="group-recs-rail-card">\n\t<h2 class="title">\n\t\t'+t.escapeExpression((a(s,"intlMessage")||i&&a(i,"intlMessage")||t.hooks.helperMissing).call(null!=i?i:t.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.GROUPS_FOR_YOU"},data:n,loc:{start:{line:3,column:2},end:{line:3,column:48}}}))+'\n\t</h2>\n\t<div class="list-container">\n\t\t<div class="dummy-loader">\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 30%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 32px; width: 64px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-section">\n\t\t\t\t\t<div class="box" style="height: 60px; width: 30%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 25%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 30%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 32px; width: 64px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-section">\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 30%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 25%"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),e={};t.Array.each([],(function(i){var s=t.Template.get("hermes/"+i);s&&(e[i]=s)})),t.Template.register("hermes/group-recs-rail-card",(function(i,n){return(n=n||{}).partials=n.partials?t.merge(e,n.partials):e,s(i,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-groups-recommendations-fetcher",(function(e,r){"use strict";function o(e){return e.sample_photos_count=8,e}e.namespace("ModelFetchers")["flickr-groups-recommendations"]={run:function(s,p){var t=this,n=o({page:s.page||1,per_page:s.perPage||4,extras:(s.extras||"")+",icon_urls, sizes"});return e.Promise.all([p.callAPI("flickr.groups.recommendations",n,!0),p.getModelRegistry("group-recommended-list-models"),p.getModelRegistry("group-recommended-models")]).then((function(e){return t._processResponse(e,n,s)}),e.FetcherErrorLogger(r))},_processParams:o,_processResponse:function(r,o,s){var p=r[0].groups.group,t=r[1],n=r[2],a={},i=[];return e.each(p,(function(e){var r;e.id=e.nsid,r=n.parseGroupModel(e),n.addOrUpdate(r),i.push(n.proxy(r.id))})),a.id="none",a.groups={perPage:o.per_page,page:o.page,pageContent:i,totalItems:r[0].groups.total},t.addOrUpdate(a),i}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["group-info-models","group-models"]});YUI.add("group-recommended-list-models",(function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-groups-recommendations"].run(r,this.appContext)}},attributes:{groups:{isCollection:!0,pageFetch:{listFetcher:e.ModelFetchers["flickr-groups-recommendations"]}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-groups-recommendations-fetcher","attribute-helpers"]});YUI.add("group-recs-rail-card-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("group-recs-rail-card-view",e.Views["rail-card-view"],[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.groupRecs=e.groupRecs,this.justifiedLayout=require("justified-layout")},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-recs-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Group Recs","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.groupRecs&&this.groupRecs.length>0?e.Promise.resolve():this.loadRecs()).then((()=>t.buildLayout())).then((()=>(t.dummyLoaderNode.addClass("hidden"),this)))},buildLayout:function(){var e=this;e.groupRecs.forEach((function(t){e.buildGroupLayout(t)}))},buildGroupLayout:function(e){var t=this;this.appContext.getView("group-recs-rail-item-view",Object.assign({appContext:this.appContext},e)).then((function(e){return e.initialize()})).then((function(e){return t.listContainerNode.appendChild(e.get("container")),e.activate()}))},loadRecs:function(){var e=this;return this.appContext.getModel("group-recommended-list-models",{id:"none",perPage:2}).then((function(t){e.recsModel=t,e.groupRecs=t.getValue("groups").getList().map((function(e){return Object.assign({model:e},e.toJSON())}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())}})}),"@VERSION@",{requires:["flickr-view","rail-card-view","photo-card-view","group-recs-rail-item-view","hermes-template-group-recs-rail-card","hermes-template-group-recs-rail-item","hermes-template-adult-content-photo-overlay","group-recommended-list-models"],optionalRequires:["hermes-core"],langBundles:["common","adult-content-overlay","feed"]});YUI.add("photo-page-sidebar-view",(function(e,t){let i=require("hermes-core/flog")(t),o=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","photo-attribution"],parentViewName:this.name},"sub-photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,parentViewName:this.name},"photo-charm-exif-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,parentViewName:this.name},"sub-photo-right-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"sub-photo-date-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"getty-widget-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,type:"photoPage",sidebar:!0,disabled:function(){return!this.appContext.gettyHelper.canShowWidgetType()||this.appContext.adManager.userCanViewPhotoPageSidebar()}},"sub-photo-submoola-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,showUpgradeProLink:!1,adPosition:0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||!this.appContext.adManager.canShowAd(this)||this._params.ownerIsPro}},"explore-rail-card-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-interstitial-ad-on-photopage")}},"group-recs-rail-card-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-interstitial-ad-on-photopage")}}},initializer:function(t){return this.photoId=t.photoId,this.detachedConfig,this.showPhotoPageAd=!0,this.showGettyWidget=!1,this.nodeObserver,this.sidebarResizeThrottle=16,this.params=t,this.isAd=t.isAd||!1,e.Promise.resolve()},loadState:function(){let t=this;return this.appContext.getModel("photo-models",t.photoId).then((function(o){if(t.set("photo",o),t.appContext.adManager.canShowAdWithPhoto(t.get("photo"))){if(t.appContext.flipper.isFlipped("enable-page-categorizations"))return t.appContext.getModel("page-categorizations-models",t.photoId).then((function(i){t.set("categories",i.getValue("categories")),e.Snowplough.sendSelfDescribingEvent({schema:e.Snowplough.SCHEMAS.PAGE_CATEGORIZATIONS,data:{photoId:parseInt(t.photoId,10),status:"received",result:[t.get("categories")],source:i.getValue("source")}})})).catch((function(e){i.error("Error loading photo categorizations: ",e)}))}else t.showPhotoPageAd=!1}))},buildContainer:function(){this.setContainerWithTemplate("photo-page-sidebar",{showGettyWidget:this.showGettyWidget,sidebarWidth:e.config.flickr.photopage.sidebarWidth,isAd:this.isAd,upgradeUrl:o.getProLandingPageUrl(o.UTM_INTERSTITIAL_SIDEBAR)})},activate:function(){let t=!1,i=this.get("container"),o=this,a=o.get("photo");return this.isAd?(this.setCorrectSidebarHeight(),this.registerEventHandler(e.on("resize",e.betterThrottle((e=>{this.setCorrectSidebarHeight()}),this.sidebarResizeThrottle,this))),e.Promise.resolve()):(this.registerEventHandler(i.one(".fave-count").on("click",this.faveCountClicked.bind(this))),this.registerEventHandler(i.one(".comment-count").on("click",this.commentCountClicked.bind(this))),this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||this.registerEventHandler(e.on("resize",e.betterThrottle((t=>{this.showGettyWidget||(this.showPhotoPageAd&&this.appContext.viewportData.getWidthWithScrollbars()>=1081?e.one("body").one(".detached-moola-unit")||this.setDetachedMoolaUnit():e.one("body").one(".detached-moola-unit")&&this.appContext.adManager.removeDetachedAdUnit()),this.setCorrectSidebarHeight()}),this.sidebarResizeThrottle,this))),this.showGettyWidget?(a&&this.registerEventHandler(a.on("valuesChanged",(function(e){e.safetyLevel&&o.canShowGettyWidget()}))),this.canShowGettyWidget(),t=!1):this.showPhotoPageAd?this.appContext.viewportData.getWidthWithScrollbars()>=1081&&(t=!0):(i.one(".moola-content-spacing")&&i.one(".moola-content-spacing").setStyle("display","none"),this.appContext.adManager.destroyAdUnitsOnPage(!0)),this.setCorrectSidebarHeight(),this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||t&&this.setDetachedMoolaUnit(),this.setSiblingObserver(),e.Promise.resolve())},canShowGettyWidget:function(){let e=this.showGettyWidget,t=this.get("photo");this.appContext.adManager.canShowAdWithPhoto(t)&&this.appContext.gettyHelper.canShowWidgetType()?this.showGettyWidget=!1:this.showGettyWidget=!0,e!==this.showGettyWidget&&this.buildContainer()},faveCountClicked:function(t,i){t.preventDefault();var o=new e.Views["photo-faves-list-view"]({photoId:this.photoId,appContext:this.appContext});this.favesModal=new e.Views.FluidModal({appContext:this.appContext,subview:o,height:550,flexLayout:!0,hasSubviewConfigRefactor:!0,theme:this.params.theme}),this.favesModal.show()},commentCountClicked:function(){var t={appContext:this.appContext,photoId:this.photoId,isScrollable:!0,hasHeader:!0},i=new e.ModalDroparoundHelper(this.appContext,{useViewportType:!1,containerType:"modal",configs:{common:{subviewName:"photo-comments-view",subviewParams:t},modal:{height:550,flexLayout:!0,theme:this.params.theme}}});this.registerEventHandler(i.on("close",(()=>{e.fire("photoCommentModalClosed",{photoId:this.photoId})}))),this.registerEventHandler(e.on("addComment:showingSignupModal",(()=>{i.close()}))),i.show()},setCorrectSidebarHeight:function(){let t,i,o=this.get("container"),a=e.one("body").one(".height-controller");o&&a&&o.one(".scrollable-container")&&(t=o.get("offsetHeight"),i=a.get("offsetHeight"),(i<t||i>t)&&o.setStyle("maxHeight",`${i}px`))},setDetachedMoolaUnit:function(){const t=this,i=this.get("container"),o=e.config.flickr.moola.positions.photopage[0],a=this.appContext.viewportData.getWidthWithScrollbars(),n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;this.adConfig={adUnit:o[a<n?"ad_unit_mobile":"ad_unit_desktop"]},this.adEventStitch=this.appContext.adManager.getHashedAdValue(this.appContext.adManager.getAdPositioning(i)),this.adUnit=this.adConfig.adUnit,this.detachedConfig={template:this.templates("prbd-moola-position")({adUnit:this.adConfig.adUnit,advertisingStitching:this.adEventStitch,categories:this.appContext.flipper.isFlipped("enable-page-categorizations")?this.appContext.adManager.getAdCategories(this.get("categories")):"",class:"detached-moola-unit"}),detachedContainer:e.one("body").one("#detached-moola-container"),anchorNode:i.one(".moola-detached-container"),route:"photo-route"},this.registerEventHandler(e.on("resize",e.betterThrottle((e=>{this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)}),this.sidebarResizeThrottle,this))),document.querySelector(".detached-moola-unit")||this.registerEventHandler(e.on("photoPage:dataLayerReadyForAds",(()=>{this.appContext.adManager.initDetachedMoolaUnit(this.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),this.detachedSanityCheck=setTimeout((function(){t.appContext.adManager.repositionDetachedMoolaUnit(t.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),clearTimeout(t.detachedSanityCheck)}),500)})))},setSiblingObserver:function(){const e=this.get("container").getDOMNode();this.nodeObserver=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&(this.get("container").one(".moola-detached-container")&&this.showPhotoPageAd?(this.setCorrectSidebarHeight(),this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)):this.setCorrectSidebarHeight())}))}));this.nodeObserver.observe(e,{childList:!0,subtree:!0})},destructor:function(){this.nodeObserver&&this.nodeObserver.disconnect&&this.nodeObserver.disconnect(),this.appContext.adManager.nextPhotoIsAdFriendly()||this.appContext.adManager.destroyAdUnitsOnPage(!0)}},{})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-sidebar","hermes-template-prbd-moola-position","attribution-view","sub-photo-title-desc-view","photo-charm-exif-scrappy-view","sub-photo-right-stats-view","sub-photo-date-view","photo-license-view","fluid-modal-view","fluid-droparound-view","getty-widget-view","sub-photo-submoola-view","explore-rail-card-view","group-recs-rail-card-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["photo-page-scrappy","common"]});